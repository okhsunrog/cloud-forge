# Coturn TURN/STUN server configuration for Nextcloud Talk
# {{ ansible_managed }}

# Listening port for STUN/TURN (both TURN and TURNS recommended by Nextcloud)
listening-port=3478

# Listening IP (0.0.0.0 for all interfaces)
listening-ip=0.0.0.0

# External IP address (automatically detected if not set)
# external-ip=YOUR_PUBLIC_IP

# Relay ports range
min-port={{ coturn_relay_min_port }}
max-port={{ coturn_relay_max_port }}

# Enable verbose logging
verbose

# Log file path
log-file={{ coturn_log_path }}/turnserver.log

# Realm for TURN server
realm={{ coturn_realm }}

# Use static auth secret (recommended for Nextcloud)
{% if coturn_static_secret is defined %}
use-auth-secret
static-auth-secret={{ coturn_static_secret }}
{% endif %}

# SSL/TLS certificates (Let's Encrypt)
cert=/etc/letsencrypt/live/{{ coturn_realm }}/fullchain.pem
pkey=/etc/letsencrypt/live/{{ coturn_realm }}/privkey.pem

# Cipher list for TLS
cipher-list="ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384"

# Disable UDP relay endpoints (optional, use only if needed)
# no-udp-relay

# Disable TCP relay endpoints (optional, use only if needed)
# no-tcp-relay

# Enable TLS/TURNS
tls-listening-port=5349

# Disable TLS 1.0 and 1.1
no-tlsv1
no-tlsv1_1

# Mobility support
mobility

# Fingerprint in TURN messages
fingerprint

# No multicast peers
no-multicast-peers

# Prevent stale nonce attacks
stale-nonce

# User quota (max 100 concurrent sessions per user)
user-quota=100

# Total quota (0 = unlimited, recommended by Nextcloud)
total-quota=0

# Bandwidth capacity (0 = unlimited)
bps-capacity=0

# Disable CLI
no-cli

# Run as user/group
proc-user=turnserver
proc-group=turnserver
